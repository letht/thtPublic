"use strict";!function(t){ys.head.$doc.on("click."+t+" auto."+t,"[data-"+t+"]",(function(a){var i=$(this),o=$.extend({on:"click"},i.data(t)),n=["lr","bi","fd"];if("auto"==a.type||"click"==a.type&&!i.is(".pj-on-autoload")){if(o.data)for(var e in n)if(n.hasOwnProperty(e)){var s=n[e];if(o.data[s]){new ys.userHisto({item:"pjhisto-"+s,dKey:"ts",isSameHit:function(t,a){return $.isPlainObject(t[s])&&$.isPlainObject(a[s])?JSON.stringify(t[s])===JSON.stringify(a[s]):t[s]===a[s]}}).add(o.data);break}}"auto"==o.on&&i.removeAttr("data-"+t).removeData(t)}})),ys.head.onScan(".pj-on-autoload[data-"+t+"]",(function(){$(this).trigger("auto."+t)}))}("pjsethisto");"use strict";ys.userHisto=function(t){this._={ko:!1,options:{item:"pjuserhisto",max_mem:100,ttl:60,off:0,dKey:"lastUpdate",autoLoad:1,isSameHit:0},emptyHisto:{t:[]},histo:0},this.init(t)},ys.userHisto.hasStorage=!0,ys.userHisto.prototype={init:function(t){this.setOptions(t),this._.histo=this._.emptyHisto,this._.options.autoLoad&&this.load()},isOk:function(){return!this._.ko},setOptions:function(t){if(this._.options=$.extend(!0,{},this.getOptions(),t),this._.options.user_off=localStorage.getItem(this._.options.item+"_off"),(this._.options.off||this._.options.user_off)&&(this.clear(),this._.ko=!0),this._.options.shortKeys)for(var i in this._.options.verboseKeys={},this._.options.shortKeys)this._.options.shortKeys.hasOwnProperty(i)&&(this._.options.verboseKeys[this._.options.shortKeys[i]]=i)},getOptions:function(){return this._.options},disable:function(){this.clear(),this._.options.user_off=1,localStorage.setItem(this._.options.item+"_off",1),this._.ko=!0},enable:function(){this._.options.user_off=0,localStorage.removeItem(this._.options.item+"_off"),this._.ko=!this._.options.off},getHisto:function(){return this._.histo||this._.emptyHisto},load:function(){if(!this._.ko){try{var t=localStorage.getItem(this._.options.item);new RegExp("<script[^>]*>(.*?)</script[^>]*>|<javascript[^>]*>(.*?)</javascript[^>]*>").test(t)?this.remove(this._.options.item):this._.histo=$.parseJSON(t)}catch(t){}this._.histo=this._.histo||this._.emptyHisto,this._.histo.t=this.changeKeys(this._.histo.t,this._.options.verboseKeys),this.purgeTTL()}},save:function(){if(!this._.ko){var t=this._.emptyHisto;t.t=this.changeKeys(this._.histo.t,this._.options.shortKeys,!0);try{localStorage.setItem(this._.options.item,JSON.stringify(t))}catch(t){}}},clear:function(){this._.ko||(localStorage.removeItem(this._.options.item),this._.histo=this._.emptyHisto)},purgeTTL:function(){if(!this._.ko){var t=!1,i=new Date;i.setDate(i.getDate()-this._.options.ttl),i.setHours(0,0,0,0),i=i.getTime();for(var s=this._.histo.t.length-1;s>=0&&!(this._.histo.t[s][this._.options.dKey]>=i);s--)this._.histo.t.splice(s,1),t=!0;this.purgeMax(t)}},purgeMax:function(t){if(!this._.ko){for(var i=t;this._.histo.t.length>this._.options.max_mem;)this._.histo.t.pop(),i=!0;i&&this.save()}},add:function(t){if(!this._.ko){if(t[this._.options.dKey]=ys.head.now(),$.isFunction(this._.options.isSameHit))for(var i=0,s=this._.histo.t.length;i<s;i++){var o=this._.histo.t[i];if(this._.options.isSameHit(o,t)){this._.histo.t.splice(i,1);break}}this._.histo.t.unshift(t),this.purgeMax(!0)}},remove:function(t){if(!this._.ko&&t){var i=!1;if($.isFunction(this._.options.isSameHit))for(var s=0,o=this._.histo.t.length;s<o;s++){var e=this._.histo.t[s];if(this._.options.isSameHit(e,t)){this._.histo.t.splice(s,1),i=!0;break}}return i&&this.save(),i}},changeKeys:function(t,i,s){var o,e,h,n,r,_=i?[]:t;if(i)for(o in t)if(t.hasOwnProperty(o)){for(h in n={},e=t[o])e.hasOwnProperty(h)&&e.hasOwnProperty(h)&&(r=i.hasOwnProperty(h)?i[h]:s?null:h)&&(n[r]=e[h]);_.push(n)}return _}};