!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"function"==typeof require?e(require("jquery")):e(jQuery)}((function(e){"use strict";var t={escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(e){var t=document.createElement("div");return t.className=e,t.style.display="none",t}},s=27,i=9,n=13,o=37,a=38,l=39,r=40;function u(t,s){var i=function(){},n={ajaxSettings:{},autoSelectFirst:!1,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:u.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:i,onSearchComplete:i,onSearchError:i,preserveInput:!1,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:function(e,t,s){return-1!==e.value.toLowerCase().indexOf(s)},paramName:"query",transformResult:function(e){return"string"==typeof e?JSON.parse(e):e},showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:!1};this.element=t,this.el=e(t),this.suggestions=[],this.badQueries=[],this.selectedIndex=-1,this.currentValue=this.element.value,this.intervalId=0,this.cachedResponse={},this.onChangeInterval=null,this.onChange=null,this.isLocal=!1,this.suggestionsContainer=null,this.noSuggestionsContainer=null,this.options=e.extend({},n,s),this.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},this.hint=null,this.hintValue="",this.selection=null,this.initialize(),this.setOptions(s)}u.utils=t,e.Autocomplete=u,u.formatResult=function(e,s){var i="("+t.escapeRegExChars(s)+")";return e.value.replace(new RegExp(i,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")},u.prototype={killerFn:null,initialize:function(){var t,s=this,i="."+s.classes.suggestion,n=s.classes.selected,o=s.options;s.element.setAttribute("autocomplete","off"),s.killerFn=function(t){0===e(t.target).closest("."+s.options.containerClass).length&&(s.killSuggestions(),s.disableKillerFn())},s.noSuggestionsContainer=e('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0),s.suggestionsContainer=u.utils.createNode(o.containerClass),(t=e(s.suggestionsContainer)).appendTo(o.appendTo),"auto"!==o.width&&t.width(o.width),t.on("mouseout.autocomplete",(function(){s.selectedIndex=-1,t.children("."+n).removeClass(n)})),t.on("click.autocomplete",i,(function(){s.select(e(this).data("index"))})),s.fixPositionCapture=function(){s.visible&&s.fixPosition()},e(window).on("resize.autocomplete",s.fixPositionCapture),s.el.on("keydown.autocomplete",(function(e){s.onKeyPress(e)})),s.el.on("keyup.autocomplete",(function(e){s.onKeyUp(e)})),s.el.on("blur.autocomplete",(function(){s.onBlur()})),s.el.on("focus.autocomplete",(function(){s.onFocus()})),s.el.on("change.autocomplete",(function(e){s.onKeyUp(e)})),s.el.on("input.autocomplete",(function(e){s.onKeyUp(e)}))},onFocus:function(){this.fixPosition(),this.options.minChars<=this.el.val().length&&this.onValueChange()},onBlur:function(){this.enableKillerFn()},abortAjax:function(){this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null)},setOptions:function(t){var s=this.options;e.extend(s,t),this.isLocal=Array.isArray(s.lookup),this.isLocal&&(s.lookup=this.verifySuggestionsFormat(s.lookup)),s.orientation=this.validateOrientation(s.orientation,"bottom")},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){this.disabled=!0,clearInterval(this.onChangeInterval),this.abortAjax()},enable:function(){this.disabled=!1},fixPosition:function(){var t=e(this.suggestionsContainer),s=t.parent().get(0);if(s===document.body||this.options.forceFixPosition){var i=this.options.orientation,n=t.outerHeight(),o=this.el.outerHeight(),a=this.el.offset(),l={top:a.top,left:a.left};if("auto"===i){var r=e(window).height(),u=e(window).scrollTop(),c=-u+a.top-n,h=u+r-(a.top+o+n);i=Math.max(c,h)===c?"top":"bottom"}if(l.top+="top"===i?-n:o,s!==document.body){var g,d=t.css("opacity");this.visible||t.css("opacity",0).show(),g=t.offsetParent().offset(),l.top-=g.top,l.left-=g.left,this.visible||t.css("opacity",d).hide()}"auto"===this.options.width&&(l.width=this.el.outerWidth()-2+"px"),t.css(l)}},enableKillerFn:function(){e(document).on("click.autocomplete",this.killerFn)},disableKillerFn:function(){e(document).off("click.autocomplete",this.killerFn)},killSuggestions:function(){var t=this;t.stopKillSuggestions(),t.intervalId=window.setInterval((function(){t.visible&&(t.el.val(t.currentValue),t.hide()),e(document).trigger("suggestionsKilled"),t.stopKillSuggestions()}),50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var e,t=this.el.val().length,s=this.element.selectionStart;return"number"==typeof s?s===t:!document.selection||((e=document.selection.createRange()).moveStart("character",-t),t===e.text.length)},onKeyPress:function(t){var u=this;if(u.disabled||u.visible||t.which!==r||!u.currentValue){if(!u.disabled&&u.visible){switch(t.which){case s:u.el.val(u.currentValue),u.hide();break;case l:if(u.hint&&u.options.onHint&&u.isCursorAtEnd()){u.selectHint();break}if(u.options.monochamp){var c=null,h=0;if("recommandations"==u.suggestions[u.selectedIndex].data.tmplSource)return;u.suggestions.some((function(e){if("recommandations"==e.data.tmplSource){if(c=e.data.index,h==u.selectedIndex)return!0;h++}})),c&&u.adjustScroll(c)}return;case o:if(u.options.monochamp){c=0;var g=0;if(u.suggestions.some((function(e){if("recommandations"==e.data.tmplSource){if((c=e.data.index)==u.selectedIndex)return!0;g++}}))){u.suggestions.length;c>g&&u.adjustScroll(g)}}return;case i:if(u.hint&&u.options.onHint)return void u.selectHint();if(-1===u.selectedIndex)return void u.hide();if(u.select(u.selectedIndex),!1===u.options.tabDisabled)return;setTimeout((function(){e(document).trigger("click.autocomplete")}),10);break;case n:if(-1===u.selectedIndex)return void u.hide();u.select(u.selectedIndex);break;case a:u.moveUp();break;case r:u.moveDown();break;default:return}t.stopImmediatePropagation(),t.preventDefault()}}else u.suggest()},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.which){case a:case r:return}if(t.options.monochamp)switch(e.which){case l:case o:return}clearInterval(t.onChangeInterval),t.currentValue!==t.el.val()&&(t.findBestHint(),t.options.deferRequestBy>0?t.onChangeInterval=setInterval((function(){t.onValueChange()}),t.options.deferRequestBy):t.onValueChange())}},onValueChange:function(){var t=this.options,s=this.el.val(),i=this.getQuery(s);this.selection&&this.currentValue!==i&&(this.selection=null,(t.onInvalidateSelection||e.noop).call(this.element)),clearInterval(this.onChangeInterval),this.currentValue=s,this.selectedIndex=-1,t.triggerSelectOnValidInput&&this.isExactMatch(i)?this.select(0):i.length<t.minChars?this.hide():this.getSuggestions(i)},isExactMatch:function(e){var t=this.suggestions;return 1===t.length&&t[0].value.toLowerCase()===e.toLowerCase()},getQuery:function(e){var t,s=this.options.delimiter;return s?(t=e.split(s))[t.length-1].trim():e},getSuggestionsLocal:function(t){var s,i=this.options,n=t.toLowerCase(),o=i.lookupFilter,a=parseInt(i.lookupLimit,10);return s={suggestions:e.grep(i.lookup,(function(e){return o(e,t,n)}))},a&&s.suggestions.length>a&&(s.suggestions=s.suggestions.slice(0,a)),s},getSuggestions:function(t){var s,i,n,o,a=this,l=a.options,r=l.serviceUrl;l.params[l.paramName]=t,i=l.ignoreParams?null:l.params,!1!==l.onSearchStart.call(a.element,l.params)&&("function"!=typeof l.lookup?(a.isLocal?s=a.getSuggestionsLocal(t):("function"==typeof r&&(r=r.call(a.element,t)),n=r+"?"+e.param(i||{}),s=a.cachedResponse[n]),s&&Array.isArray(s.suggestions)?(a.suggestions=s.suggestions,a.suggest(),l.onSearchComplete.call(a.element,t,s.suggestions)):l.getSuggestionsResponse?l.getSuggestionsResponse(t,(function(e){a.processResponse(e,t,n),l.onSearchComplete.call(a.element,t)})):a.isBadQuery(t)?l.onSearchComplete.call(a.element,t,[]):(a.abortAjax(),o={url:r,data:i,type:l.type,dataType:l.dataType},e.extend(o,l.ajaxSettings),a.currentRequest=e.ajax(o).done((function(e){var s;a.currentRequest=null,s=l.transformResult(e,t),a.processResponse(s,t,n),l.onSearchComplete.call(a.element,t,s.suggestions)})).fail((function(e,s,i){l.onSearchError.call(a.element,t,e,s,i)})))):l.lookup(t,(function(e){a.suggestions=e.suggestions,a.suggest(),l.onSearchComplete.call(a.element,t,e.suggestions)})))},isBadQuery:function(e){if(!this.options.preventBadQueries)return!1;for(var t=this.badQueries,s=t.length;s--;)if(0===e.indexOf(t[s]))return!0;return!1},hide:function(){var t=e(this.suggestionsContainer);"function"==typeof this.options.onHide&&this.visible&&this.options.onHide.call(this.element,t),this.visible=!1,this.selectedIndex=-1,clearInterval(this.onChangeInterval),e(this.suggestionsContainer).hide(),this.signalHint(null)},suggest:function(){if(0!==this.suggestions.length){var t,s=this.options,i=s.groupBy,n=s.formatResult,o=this.getQuery(this.currentValue),a=this.classes.suggestion,l=this.classes.selected,r=e(this.suggestionsContainer),u=e(this.noSuggestionsContainer),c=s.beforeRender,h="";s.triggerSelectOnValidInput&&this.isExactMatch(o)?this.select(0):("function"==typeof s.getSuggestionsInnerHTML?h+=s.getSuggestionsInnerHTML(this.suggestions,o):e.each(this.suggestions,(function(e,s){i&&(h+=function(e,s){var n=e.data[i];return t===n?"":'<div class="autocomplete-group"><strong>'+(t=n)+"</strong></div>"}(s,0)),h+='<div class="'+a+'" data-index="'+e+'">'+n(s,o)+"</div>"})),this.adjustContainerWidth(),u.detach(),r.html(h),"function"==typeof c&&c.call(this.element,r),this.fixPosition(),r.show(),s.autoSelectFirst&&(this.selectedIndex=0,r.scrollTop(0),r.children("."+a).first().addClass(l)),this.visible=!0,this.findBestHint())}else this.options.showNoSuggestionNotice&&this.el.val().length>0?this.noSuggestions():this.hide()},noSuggestions:function(){var t=e(this.suggestionsContainer),s=e(this.noSuggestionsContainer);this.adjustContainerWidth(),s.detach(),t.empty(),t.append(s),this.fixPosition(),t.show(),this.visible=!0},adjustContainerWidth:function(){this.options,e(this.suggestionsContainer)},findBestHint:function(){var t=this.el.val().toLowerCase(),s=null;t&&(e.each(this.suggestions,(function(e,i){var n=0===i.value.toLowerCase().indexOf(t);return n&&(s=i),!n})),this.signalHint(s))},signalHint:function(t){var s="";t&&(s=this.currentValue+t.value.substr(this.currentValue.length)),this.hintValue!==s&&(this.hintValue=s,this.hint=t,(this.options.onHint||e.noop)(s))},verifySuggestionsFormat:function(t){return t.length&&"string"==typeof t[0]?e.map(t,(function(e){return{value:e,data:null}})):t},validateOrientation:function(e,t){return e=(e||"").trim().toLowerCase(),["auto","bottom","top"].includes(e)||(e=t),e},processResponse:function(e,t,s){var i=this.options;e.suggestions=this.verifySuggestionsFormat(e.suggestions),i.noCache||(this.cachedResponse[s]=e,i.preventBadQueries&&0===e.suggestions.length&&this.badQueries.push(t)),t===this.getQuery(this.currentValue)&&(this.suggestions=e.suggestions,this.suggest())},activate:function(t){var s,i=this.classes.selected,n=e(this.suggestionsContainer),o=n.find("."+this.classes.suggestion);return n.find("."+i).removeClass(i),this.selectedIndex=t,-1!==this.selectedIndex&&o.length>this.selectedIndex?(s=o.get(this.selectedIndex),e(s).addClass(i),s):null},selectHint:function(){var t=e.inArray(this.hint,this.suggestions);this.select(t)},select:function(e){this.hide(),this.onSelect(e)},moveUp:function(){if(-1!==this.selectedIndex)return 0===this.selectedIndex?(e(this.suggestionsContainer).children().first().removeClass(this.classes.selected),this.selectedIndex=-1,this.el.val(this.currentValue),void this.findBestHint()):void this.adjustScroll(this.selectedIndex-1)},moveDown:function(){this.selectedIndex!==this.suggestions.length-1&&this.adjustScroll(this.selectedIndex+1)},adjustScroll:function(t){var s=this.activate(t);if(s){var i,n,o,a=e(s).outerHeight();i=s.offsetTop,o=(n=e(this.suggestionsContainer).scrollTop())+this.options.maxHeight-a,i<n?e(this.suggestionsContainer).scrollTop(i):i>o&&e(this.suggestionsContainer).scrollTop(i-this.options.maxHeight+a),this.options.preserveInput||this.el.val(this.getValue(this.suggestions[t].value)),this.signalHint(null)}},onSelect:function(e){var t=this.options.onSelect,s=this.suggestions[e];null!=s&&("function"==typeof this.options.onBeforeSelect&&this.options.onBeforeSelect.call(this.element,this.currentValue,s.value,this.getValue(s.value)),this.currentValue=this.getValue(s.value),this.currentValue===this.el.val()||this.options.preserveInput||!0===s.data.preserveInput||this.el.val(this.currentValue),this.signalHint(null),this.suggestions=[],this.selection=s,"function"==typeof t&&t.call(this.element,s))},getValue:function(e){var t,s,i=this.options.delimiter;return i?1===(s=(t=this.currentValue).split(i)).length?e:t.substr(0,t.length-s[s.length-1].length)+e:e},dispose:function(){this.el.off(".autocomplete").removeData("autocomplete"),this.disableKillerFn(),e(window).off("resize.autocomplete",this.fixPositionCapture),e(this.suggestionsContainer).remove()}},e.fn.autocomplete=e.fn.devbridgeAutocomplete=function(t,s){var i="autocomplete";return 0===arguments.length?this.first().data(i):this.each((function(){var n=e(this),o=n.data(i);"string"==typeof t?o&&"function"==typeof o[t]&&o[t](s):(o&&o.dispose&&o.dispose(),o=new u(this,t),n.data(i,o))}))}}));"use strict";var _permissionState,ff_m86750=ys.perfo.on&&ys.head.ff("m86750"),LS_GEOLOC_STATUS_KEY="pjGeolocStatus";ys.head.addAction("geolocation-permission",(function(t){_permissionState=t})),ys.pjaccore=function(t,e,s){arguments.length&&(ff_m86750&&this.perfo("pjaccore new instance"),this._={options:{max_tot:10,max_his:10,template:"template-"+e,appendTo:"body",ariaLiveTarget:!1,containerClass:"autocomplete-suggestions",showNoSuggestionNotice:!1,templateNoSuggestionNotice:"template-no-sugg-"+e,hint:!0,histo:{item:e,shortKeys:{libelle:"l",id:"id",lastUpdate:"d"},isSameHit:function(t,e){return t.libelle===e.libelle}},etab:!1,statsKeys:null,beforeHisto:null,beforeSubmit:null},$input:t,cn:e,thisNS:e+$.guid++,userHisto:null},this.init(t,e,s))},ys.pjaccore._ariaLiveFirst=!1,ys.pjaccore.prototype={perfo:function(t,e){var s="";this._&&(this._.cn&&(s+="input[data-"+this._.cn+"]"),this._.$input&&(s+="[name="+this._.$input.attr("name")+"]"),s+=":"),ys.perfo.glob[e||"top"](s+t)},init:function(t,e,s){ff_m86750&&this.perfo("pjaccore start init");var i=this,a=this.setOptions($.extend(!0,{},s||{},t.data(e)||{}));t.autocomplete({deferRequestBy:0,triggerSelectOnValidInput:!1,noCache:!0,minChars:0,appendTo:a.appendTo,containerClass:a.containerClass,showNoSuggestionNotice:a.showNoSuggestionNotice,noSuggestionNotice:a.noSuggestionNotice,getSuggestionsResponse:function(s,o){var n={suggestions:[]};s=s||"",ff_m86750&&i.perfo("q="+s+": start getSuggestions"),t.data("nbHisto."+e,0),t.data("nbTop."+e,0),t.data("acSollicitee."+e,1),(a.autour_de_moi_libelle&&-1!==s.indexOf(a.autour_de_moi_libelle)||a.autour_de_moi_libelle_init&&-1!==s.indexOf(a.autour_de_moi_libelle_init)||a.zone_definie_par_la_carte_libelle&&-1!==s.indexOf(a.zone_definie_par_la_carte_libelle))&&(t.val("").trigger("change.ctrl16i"),setTimeout((function(){$(a.appendTo+" ."+a.containerClass).filter((function(){return!ys.head.commonFilters.isHidden(this)})).show()}),150),s="");var r=!1;if(!a.displayGeolocRequest||sessionStorage.getItem("pjCurrentPos")||null!=_permissionState&&"denied"===_permissionState||!window.localStorage.getItem(LS_GEOLOC_STATUS_KEY)||"denied"===window.localStorage.getItem(LS_GEOLOC_STATUS_KEY)||(n.suggestions.push({value:"",data:{index:0,source:"geoloc",tmplSource:"geoloc",notHistorisable:!0,preserveInput:!0}}),r=!0),"function"==typeof a.beforeHisto&&a.beforeHisto(a,n,i,s),i.userHisto&&i.userHisto.isOk()){var l=s.toLowerCase(),c=i.userHisto.getHisto(),u=ys.head.ac.getHighlightingRegs(s,t.data("hlRegs."+e));t.data("hlRegs."+e,u);for(var p=0,g=c.t.length;p<g;p++){var h=c.t[p];if(!l||h.libelle&&h.libelle.toLowerCase().startsWith(l)){if(n.suggestions.length>=a.max_his)break;h.index=n.suggestions.length,h.highlightLibelle=l?h.libelle.replace(u.hlReg,"<strong>$1</strong>"):h.libelle,h.statSource="HISTORIQUE",h.tmplSource="historique",n.suggestions.push({value:h.libelle,data:h});var d=""===t.val()?a.max_his_click:a.max_his;if(n.suggestions.length>=(r?d+1:d))break}}ff_m86750&&i.perfo("q="+s+": end getHistoriqueSuggestions")}s.length&&"function"==typeof a.externalSearch?a.externalSearch.call(i,s,o,n,t):o(n)},getSuggestionsInnerHTML:function(s,o){ff_m86750&&i.perfo("q="+o+": Debut Formatage HTML de l'AC");for(var n=s.length,r={historique:[]},l=0;l<n;l++){var c=s[l];null==r[c.data.tmplSource]?r[c.data.tmplSource]=[c.data]:r[c.data.tmplSource].push(c.data)}if(t.data("nbGeo."+e,s.filter((function(t){return null!=t.data.codeEtab})).length),t.data("nbHisto."+e,r.historique.length),t.data("nbTop."+e,n-r.historique.length),a.ariaLiveTarget){var u=0;for(l in r)!1!==r.hasOwnProperty(l)&&(u+=r[l].length);var p=u+" choix disponibles";!1===ys.pjaccore._ariaLiveFirst&&(p+=", parcourez les avec les flèches haut et bas"),$(a.ariaLiveTarget).text(p),ys.pjaccore._ariaLiveFirst=!0}ff_m86750&&i.perfo("q="+o+": Avant templating Mustache de l'AC");var g=$("#"+a.template),h=g.length>0?g.mustache(r).html():"";return ff_m86750&&i.perfo("q="+o+": Après templating Mustache de l'AC"),h},onBeforeSelect:function(e,s,o){if(a.statsKeys){var n=e||"",r=t.pjForm();i.statValue(a.statsKeys.saisi,n,"",r),i.statValue(a.statsKeys.nbCar,n.length,"",r)}},onSelect:function(s){if(t.pjForm().data("acSelection."+e,s),setTimeout((function(){t.change()}),100),a.triggerAcItem){var o=$(t.data("autocomplete").suggestionsContainer);if(o.length)o.find("[data-index="+s.data.index+"].autocomplete-suggestion").trigger("pjaccore.acSelect")}"function"==typeof a.select&&a.select.call(i,t,s)},onSearchComplete:function(){ff_m86750&&i.perfo("onSearchComplete","console"),ys.head._acOpen=!0},onHide:function(){ff_m86750&&i.perfo("onHide","console"),ys.head._acOpen=!1}}).on("paste."+e,(function(e){setTimeout((function(){t.trigger("change.autocomplete")}),10)})).pjCtrl16i((function(s){var i=t.pjForm(),a=i.data("acSelection."+e);if(a){var o=t.val();(a.value||"").toLowerCase()!=o.toLowerCase().trim()&&i.removeData("acSelection."+e).add(t).trigger("acUnselect."+e)}})).on("acUnselect."+e,(function(t){i.resetStatsValues()})).on("keydown keyup keydown.autocomplete",(function(t){if(13===t.which){var e=$(this),s=e.autocomplete();if(s.hasOwnProperty("suggestions")&&(s.hasOwnProperty("selectedIndex"),1)&&s.suggestions[s.selectedIndex]){var i=s.suggestions[s.selectedIndex];if(i&&i.data&&"geoloc"===i.data.source)return t.stopImmediatePropagation(),"keyup"===t.type&&(e.blur(),s.hide&&s.hide(),$(".pj-on-click[data-pjajaxgeoloc]").trigger("click.pjajaxgeoloc")),!1}}})).on("ysDestroyed",(function(e){t.pjForm().off("submit."+i._.thisNS)})),t.pjForm().on("submit."+i._.thisNS,(function(s){var o=t.pjForm(),n=o.data("acSelection."+e);if(!n&&a.autoSelectFirst){ys.head.autoselectedfirst=!0;var r=t.data("autocomplete").suggestions,l=0;if(r.length>0){let e=r[0].data,s=t.val();"geoloc"!==e.source&&"AUTOURDEMOI"!==e.statSource||!s||s===a.autour_de_moi_libelle_init||s===a.autour_de_moi_libelle||(l=1)}t.autocomplete("select",l),n=o.data("acSelection."+e)}if(i.resetStatsValues(n),n?i.userHisto&&!n.data.notHistorisable&&i.userHisto.add(n.data):i.userHisto&&"function"==typeof a.histo.user16i&&a.histo.user16i.call(i,t),!n&&a.statsKeys&&i.statValue(a.statsKeys.saisi,t.val(),"",o),n&&a.insightEventName&&"string"==typeof a.insightEventName&&"function"==typeof a.beforeInsightClickEvent)try{var c=a.beforeInsightClickEvent(n,o,t,a);"object"==typeof c&&"string"==typeof c.index&&"string"==typeof c.queryID&&Array.isArray(c.objectIDs)&&Array.isArray(c.positions)&&i.sendClickEvent($.extend({eventName:a.insightEventName},c))}catch(s){console.error(s)}return window.sessionStorage.setItem("pjaccore-stats",JSON.stringify(o.data("pjaccore-stats"))),"function"!=typeof a.beforeSubmit||a.beforeSubmit(n,o,t,a)})),ff_m86750&&this.perfo("pjaccore ends init")},setOptions:function(t){var e=$.extend(!0,this._.options,t||{});return e.histo&&(e.max_his=Math.min(e.max_his||e.max_tot,e.max_tot),e.max_his_click=Math.min(e.max_his_click||e.max_his,e.max_tot),this.userHisto=new ys.userHisto(e.histo),ff_m86750&&this.perfo("Historique User init, state ok:"+this.userHisto.isOk())),e.showNoSuggestionNotice&&(e.noSuggestionNotice=e.templateNoSuggestionNotice?$("#"+e.templateNoSuggestionNotice).mustache():"pas de résultat"),this._.options=e},getOptions:function(){return this._.options},statValue:function(t,e,s,i){if(t){var a=i||this._.$input.pjForm(),o=a.find('[name="'+t+'"]').filter(ys.head.commonSels.text+',input[type="hidden"],textarea'),n=a.data("pjaccore-stats");n&&"object"==typeof n||(n={}),0==o.length&&(""!==e&&void 0!==e||""!==s)?n[t]=e||s:(o.val(e||o.data("default_value")||s),n[t]=e||o.data("default_value")||s),a.data("pjaccore-stats",n)}},resetStatsValues:function(t){var e=this._.options;if(e.statsKeys){var s=this._.$input.pjForm(),i=t?t.data:{};this.statValue(e.statsKeys.acSollicitee,this._.$input.data("acSollicitee."+this._.cn),0,s),this.statValue(e.statsKeys.rang,t?(i.index||0)+1:"","",s),this.statValue(e.statsKeys.source,i.statSource,"",s),this.statValue(e.statsKeys.type,i.type,"",s),this.statValue(e.statsKeys.id,i.id,"",s),this.statValue(e.statsKeys.nbTop,this._.$input.data("nbTop."+this._.cn),0,s),this.statValue(e.statsKeys.nbHisto,this._.$input.data("nbHisto."+this._.cn),0,s),t||(this.statValue(e.statsKeys.saisi,"","",s),this.statValue(e.statsKeys.nbCar,"","",s))}}};"use strict";var ff_m86750=ys.perfo.on&&ys.head.ff("m86750");ys.pjalgolia=function(a,i,t){if(arguments.length){var e;ff_m86750&&this.perfo("pjalgolia new instance");var o=a.data(i);e=o&&"string"==typeof o.insightEventName?{analytics:!0,clickAnalytics:!0,analyticsTags:this.getQueryTags()}:{analytics:!1,clickAnalytics:!1},ys.pjaccore.call(this,a,i,$.extend(!0,{histo:{shortKeys:{type:"t",libelle:"l",id:"id",notHistorisable:"nh",lastUpdate:"d"},isSameHit:function(a,i){return a.id===i.id}},algolia:jQuery.extend(!0,{apiSearchParams:e},this.options),statsKeys:null},t||{}))}},ys.pjalgolia.prototype=$.extend(new ys.pjaccore,{constructor:ys.pjalgolia,init:function(a,i,t){var e=this;ff_m86750&&this.perfo("pjalgolia start init"),ys.pjaccore.prototype.init.call(this,a,i,t);var o=t.algolia;if("object"==typeof o.apiMultiParams&&null!==o.apiMultiParams)for(var n in o.apiMultiParams)if(!1!==o.apiMultiParams.hasOwnProperty(n)){var s=o.apiMultiParams[n];o.apiMultiParams[n]=$.extend(s,o.apiSearchParams)}a.one("focus",(function(){if(""===a.val().trim()){ff_m86750&&e.perfo("preload: first call search on focus");var i=e.getOptions(),t=i.algolia.apiSearchParams,o=t.hitsPerPage||i.max_tot,n=t.analytics,s=t.clickAnalytics;t.hitsPerPage=0,t.analytics=!1,t.clickAnalytics=!1,e.isPreLoadCall=!0;try{i.externalSearch.call(e,"jim",(function(){ff_m86750&&e.perfo("preload: got result","console")}),{suggestions:[]},a)}catch(a){ys.head.error(a)}t.hitsPerPage=o,t.analytics=n,t.clickAnalytics=s}})),ff_m86750&&this.perfo("pjalgolia ends init")},setOptions:function(a){var i=ys.pjaccore.prototype.setOptions.call(this,a);return i.max_tot&&(i.algolia.apiSearchParams.hitsPerPage=i.max_tot),i},options:{apiUrl:"//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js",appId:"DSK3UFAXUT",apiKey:"30a9c866c7245bafc39b9d3612ca1a95",apiIndexes:{},apiSearchParams:{getRankingInfo:1,hitsPerPage:7,allowTyposOnNumericTokens:0,useQueryEqualsOneAttributeInRanking:0,facets:"",facetFilters:""},tmplSourceName:"algolia",statSourceName:"TOP"},getAlgoliaSearch:function(){var a=this.getOptions(),i=this._.$input,t=i.data("algSearch."+this._.cn);if("undefined"==typeof algoliasearch&&!0!==i.data("pjalgolia.wait"))throw i.data("pjalgolia.wait",!0),ys.head.addAction("pjalgolia.algolia_loaded",(function(){i.autocomplete().clear(),i.trigger("change.autocomplete")})),"algoliasearch is undefined";if(!t&&(i.data("algSearch."+this._.cn,t=algoliasearch(a.algolia.appId,a.algolia.apiKey)),ff_m86750&&this.perfo("first init instance AlgoliaSearch for input: "+i.attr("name")),a.insightEventName&&"string"==typeof a.insightEventName&&"function"==typeof a.beforeInsightClickEvent))try{this.getAlgoliaSearchInsights()}catch(a){ys.head.console(a)}return t},getAlgoliaIndexName:function(a,i){var t=this.getOptions().algolia.apiIndexes;return t&&"object"==typeof t&&t.hasOwnProperty(a)?t[a]:i},getAlgoliaIndex:function(a,i){"string"==typeof i&&(a=this.getAlgoliaIndexName(i,a));var t=this._.$input.data("algIndex."+this._.cn);return t||(this._.$input.data("algIndex."+this._.cn,t=this.getAlgoliaSearch().initIndex(a)),ff_m86750&&this.perfo("first init Algolia Index: "+a+" for input: "+this._.$input.attr("name"))),t},getQueryTags:function(){if(this._query_tags)return this._query_tags;var a=[document.body.classList.contains("is_desktop")?"bwg_fix":document.body.classList.contains("is_tablet")?"bwg_tab":document.body.classList.contains("is_mobile")?"bwg_mob":"bwg_unknown"],i=document.body.classList.contains("apple")?"app_ios":document.body.classList.contains("android")?"app_android":"app_unknown";return"app_unknown"!==i&&a.push(i),this._query_tags=Object.freeze(a)},getAlgoliaSearchInsights:function(){var a,i,t,e,o,n=this;if(n._cookieConsent=void 0,ys.head.addAction("pjpolicycookie",(function(a){n._cookieConsent="consent"===a})),void 0===window.aa){a=window,i=document,t="script",a.AlgoliaAnalyticsObject="aa",a.aa=a.aa||function(){(a.aa.queue=a.aa.queue||[]).push(arguments)},e=i.createElement(t),o=i.getElementsByTagName(t)[0],e.async=1,e.src="https://cdn.jsdelivr.net/npm/search-insights@^1.0.0",o.parentNode.insertBefore(e,o);var s=this.getOptions();window.aa("init",{appId:s.algolia.appId,apiKey:s.algolia.apiKey})}return window.aa},sendClickEvent:function(a){if(void 0===this._cookieConsent&&(this._cookieConsent="1"===ys.head.Cookies.get("pj_policy_cookie")),!0===this._cookieConsent&&"function"==typeof window.aa)return window.aa("clickedObjectIDsAfterSearch",a)},alphaNumReg:/[A-ZÀ-ÖØ-ÞĀĂĄĆĈĊČĎĐĒĔĖĘĚĜĞĠĢĤĦĨĪĬĮİĲĴĶĹĻĽĿŁŃŅŇŊŌŎŐŒŔŖŘŚŜŞŠŢŤŦŨŪŬŮŰŲŴŶŸŹŻŽƁƂƄƆƇƉ-ƋƎ-ƑƓƔƖ-ƘƜƝƟƠƢƤƦƧƩƬƮƯƱ-ƳƵƷƸƼǄǇǊǍǏǑǓǕǗǙǛǞǠǢǤǦǨǪǬǮǱǴǶ-ǸǺǼǾȀȂȄȆȈȊȌȎȐȒȔȖȘȚȜȞȠȢȤȦȨȪȬȮȰȲȺȻȽȾɁɃ-ɆɈɊɌɎͰͲͶΆΈ-ΊΌΎΏΑ-ΡΣ-ΫϏϒ-ϔϘϚϜϞϠϢϤϦϨϪϬϮϴϷϹϺϽ-ЯѠѢѤѦѨѪѬѮѰѲѴѶѸѺѼѾҀҊҌҎҐҒҔҖҘҚҜҞҠҢҤҦҨҪҬҮҰҲҴҶҸҺҼҾӀӁӃӅӇӉӋӍӐӒӔӖӘӚӜӞӠӢӤӦӨӪӬӮӰӲӴӶӸӺӼӾԀԂԄԆԈԊԌԎԐԒԔԖԘԚԜԞԠԢԤԦԱ-ՖႠ-ჅḀḂḄḆḈḊḌḎḐḒḔḖḘḚḜḞḠḢḤḦḨḪḬḮḰḲḴḶḸḺḼḾṀṂṄṆṈṊṌṎṐṒṔṖṘṚṜṞṠṢṤṦṨṪṬṮṰṲṴṶṸṺṼṾẀẂẄẆẈẊẌẎẐẒẔẞẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼẾỀỂỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪỬỮỰỲỴỶỸỺỼỾἈ-ἏἘ-ἝἨ-ἯἸ-ἿὈ-ὍὙὛὝὟὨ-ὯᾸ-ΆῈ-ΉῘ-ΊῨ-ῬῸ-Ώℂℇℋ-ℍℐ-ℒℕℙ-ℝℤΩℨK-ℭℰ-ℳℾℿⅅↃⰀ-ⰮⱠⱢ-ⱤⱧⱩⱫⱭ-ⱰⱲⱵⱾ-ⲀⲂⲄⲆⲈⲊⲌⲎⲐⲒⲔⲖⲘⲚⲜⲞⲠⲢⲤⲦⲨⲪⲬⲮⲰⳀⳈⳊꙀꙂꙄꙆꙈꙊꙌꙎꙐꙒꙔꙖꙘꙚꙜꙞꙠꙢꙤꙦꙨꙪꙬꚀꚂꚄꚆꚈꚊꚌꚎꚐꚒꚔꚖꜢꜤꜦꜨꜪꜬꜮꜲꜴꜶꜸꜺꜼꜾꝀꝂꝄꝆꝈꝊꝌꝎꝐꝒꝖꝚꝤꝦꝨꝮꝹꝻꝽꝾꞀꞂꞄꞆꞋꞍꞐꞠꞢꞤꞦꞨa-zªµºß-öø-ÿāăąćĉċčďđēĕėęěĝğġģĥħĩīĭįıĳĵķĸĺļľŀłńņňŉŋōŏőœŕŗřśŝşšţťŧũūŭůűųŵŷźżž-ƀƃƅƈƌƍƒƕƙ-ƛƞơƣƥƨƪƫƭưƴƶƹƺƽ-ƿǆǉǌǎǐǒǔǖǘǚǜǝǟǡǣǥǧǩǫǭǯǰǳǵǹǻǽǿȁȃȅȇȉȋȍȏȑȓȕȗșțȝȟȡȣȥȧȩȫȭȯȱȳ-ȹȼȿɀɂɇɉɋɍɏ-ʓʕ-ʯͱͳͷͻ-ͽΐά-ώϐϑϕ-ϗϙϛϝϟϡϣϥϧϩϫϭϯ-ϳϵϸϻϼа-џѡѣѥѧѩѫѭѯѱѳѵѷѹѻѽѿҁҋҍҏґғҕҗҙқҝҟҡңҥҧҩҫҭүұҳҵҷҹһҽҿӂӄӆӈӊӌӎӏӑӓӕӗәӛӝӟӡӣӥӧөӫӭӯӱӳӵӷӹӻӽӿԁԃԅԇԉԋԍԏԑԓԕԗԙԛԝԟԡԣԥԧա-ևᴀ-ᴫᵢ-ᵷᵹ-ᶚḁḃḅḇḉḋḍḏḑḓḕḗḙḛḝḟḡḣḥḧḩḫḭḯḱḳḵḷḹḻḽḿṁṃṅṇṉṋṍṏṑṓṕṗṙṛṝṟṡṣṥṧṩṫṭṯṱṳṵṷṹṻṽṿẁẃẅẇẉẋẍẏẑẓẕ-ẝẟạảấầẩẫậắằẳẵặẹẻẽếềểễệỉịọỏốồổỗộớờởỡợụủứừửữựỳỵỷỹỻỽỿ0-9]/,isQueryToSend:function(a){return this.alphaNumReg.test(a)}}),$.isPlainObject(window.pjAlgoliaConf)&&$.extend(!0,ys.pjalgolia.prototype.options,pjAlgoliaConf),null==window.algoliasearch&&null==window.AlgoliaSearch?ys.head.addActionOnce("ys.head.after.scan.doc",(function(){setTimeout((function(){ys.head.cachedScript(ys.pjalgolia.prototype.options.apiUrl,{complete:function(){if(ys.pjalgolia.apiVersion=null!=window.algoliasearch?algoliasearch.version:null!=window.ALGOLIA_VERSION?window.ALGOLIA_VERSION:void 0,ys.pjalgolia.apiVersion){var a=ys.pjalgolia.apiVersion.split(".");ys.pjalgolia.apiMajorVersion=parseInt(a[0]),ys.head.doAction("pjalgolia.algolia_loaded")}}})}),50)})):ys.head.doAction("pjalgolia.algolia_loaded");"use strict";!function(e){ys.head.onScan("input[data-pjacou]",(function(a){var t;$(this).data("pjalgolia",t=new ys.pjalgolia($(this),e,{externalSearch:function(e,a,t,i){var o=this.getOptions(),r=this,l="q="+e+":";ff_m86750&&r.perfo(l+"prepare algoliaSearch");var n=r.getAlgoliaIndex("PROD_OuPub","ou");if(ff_m86750&&r.perfo(l+"isQueryToSend"),!this.isQueryToSend(e))return ff_m86750&&r.perfo(l+"No ! NO algolia.search"),void a(t);ff_m86750&&r.perfo(l+"Yes ! GO algolia.search"),n.search(e,o.algolia.apiSearchParams,(function(e,i){if(ff_m86750&&r.perfo(l+"Response algolia.search, err="+e),null===e){for(var n=-1,s=0;s<i.hits.length;s++){var u=i.hits[s],_=0;for(var d in t.suggestions){if(t.suggestions.hasOwnProperty(d))if(t.suggestions[d].data.id===u.objectID){_=1;break}}if(!_){var c=u._highlightResult.libelle.value.replace("<NUMVOIE>","").trim(),p=u._rankingInfo.nbTypos||0;if(p>1+(-1==n?n=p:n))break;if(u={index:t.suggestions.length,tmplSource:o.algolia.tmplSourceName,statSource:o.algolia.statSourceName,type:u._geoType,libelle:"VOIE"===u._geoType.toUpperCase()?ys.head.strip_tags(c):u.libelle.replace("<NUMVOIE>","").trim(),highlightLibelle:c,id:u.objectID,notHistorisable:!!u.not_historisable,correctionOrtho:p>0,indexPos:s,queryID:i.queryID},t.suggestions.push({value:u.libelle,data:u}),t.suggestions.length>=o.max_tot)break}}ff_m86750&&r.perfo(l+"Fin post-traitement response algolia.search")}a(t)}))},histo:{user16i:function(e){var a=e.val().trim();if(a){var t=e.data("autocomplete").suggestions;a=a.desaccentuer().toLowerCase();for(var i=0,o=t.length;i<o;i++){var r=t[i];if(this.getOptions().algolia.tmplSourceName==r.data.tmplSource)if(ys.head.pjacou_ambi){for(var l=0,n=ys.head.pjacou_ambi.length;l<n;l++)if(r.data.id==ys.head.pjacou_ambi[l]){!r.data.notHistorisable&&this.userHisto.add(r.data);break}}else if(a===r.value.replace(/\([0-9]+\)/i,"").trim().desaccentuer().toLowerCase()){!r.data.notHistorisable&&this.userHisto.add(r.data);break}}}}},statsKeys:{acSollicitee:"acOuSollicitee",rang:"rangOu",source:"sourceOu",type:"typeOu",id:"idOu",nbTop:"nbPropositionOuTop",nbHisto:"nbPropositionOuHisto",saisi:"ouSaisi",nbCar:"ouNbCar"},beforeInsightClickEvent:function(e,a,i,o){return{index:t.getAlgoliaIndexName("ou","PROD_OuPub"),eventName:o.clickEventName,queryID:e.data.queryID,objectIDs:[e.data.id],positions:[e.data.indexPos+1]}},select:function(e,a){if(ys.head.ff("FF_AC_WHERE_SELECTION")){var t=$("[data-pjacqq],[data-pjacqqgeo]");t.length&&t.val().length&&e.submit()}},beforeHisto:function(e,a){var t=0;if(e.zone_definie_par_la_carte&&e.zone_definie_par_la_carte_libelle&&ys.head.pjcarte&&""==i.val()&&(a.suggestions.push({value:e.zone_definie_par_la_carte_libelle||"zone_definie_par_la_carte",data:{correctionOrtho:!1,highlightLibelle:"zdc",id:"",index:t,libelle:"zdc",type:"",notHistorisable:!0,tmplSource:"zone_definie_par_la_carte",statSource:"ZONE_DEFINIE_PAR_LA_CARTE"}}),t++),e.autour_de_moi&&e.autour_de_moi_libelle&&ys.head.pjGetCurrentPositionSession()){(!1!==e.hasOwnProperty("autour_de_moi_only_empty")&&!e.autour_de_moi_only_empty||""==i.val())&&(a.suggestions.push({value:e.autour_de_moi_libelle||"autourdemoi",data:{correctionOrtho:!1,highlightLibelle:"adm",id:"",index:t,libelle:"adm",type:"",notHistorisable:!0,tmplSource:"autourdemoi",statSource:"AUTOURDEMOI"}}),t++)}},beforeSubmit:function(e,a,t,i){if(t.val()===i.autour_de_moi_libelle||t.val()===i.autour_de_moi_libelle_init){e&&e.data;for(var o=["accuracy","latitude","longitude"],r=ys.head.pjGetCurrentPositionSession(),l=0;l<o.length;l++)a.pjSetHiddenValue(o[l],r.coords[o[l]])}if(t.val()===i.zone_definie_par_la_carte_libelle){var n=$("[data-pjcarto]").data("pjcarto");if(n&&n.isFd){var s=ys.head.pjcarte.getCenter(),u=ys.head.pjcarte.getBounds(),_={zoom:ys.head.pjcarte.getZoom(),centerx:s.lng,centery:s.lat,toprightx:u._northEast.lng,toprighty:u._northEast.lat,bottomleftx:u._southWest.lng,bottomlefty:u._southWest.lat,rayon:u._northEast.distanceTo(u._southWest)/2};for(var d in _)if(_.hasOwnProperty(d)){a.find('input[name="'+d+'"]').remove();t=$($("<input>").attr("type","hidden").attr("name",d).val(_[d]));a.append(t)}return!0}return ys.head.doAction("relance.pjcarto"),!1}return!0}}));var i=$(this),o=i.data(e);o.zone_definie_par_la_carte&&o.zone_definie_par_la_carte_libelle&&(ys.head.pjacou_val_init=i.val(),i.val(o.zone_definie_par_la_carte_libelle)),o.displayGeolocRequest?(ys.head.addAction("geolocation-permission",(function(e){"granted"===e||i.val()!==o.autour_de_moi_libelle||sessionStorage.getItem("pjCurrentPos")||i.val("").trigger("change.ctrl16i")})),ys.head.addAction("geolocRunningChange",(function(e){!1===e&&sessionStorage.getItem("pjCurrentPos")&&i.val(o.autour_de_moi_libelle).trigger("change.ctrl16i")}))):o.autour_de_moi&&(o.autour_de_moi_libelle_init||o.autour_de_moi_libelle)&&""==i.val()&&ys.head.$doc.pjGetCurrentPosition((function(e){i.val(o.autour_de_moi_libelle_init||o.autour_de_moi_libelle).trigger("change.ctrl16i")}));var r=function(e){ys.head.removeAction("geolocation-permission",r),"granted"===e&&""===i.val()&&(o.autour_de_moi_libelle_init||o.autour_de_moi_libelle)&&sessionStorage.getItem("pjCurrentPos")&&i.val(o.autour_de_moi_libelle).trigger("change.ctrl16i")};ys.head.addAction("geolocation-permission",r)})),ys.head.addAction(e+".pjsetinput",(function(e){ys.head.pjacou_ambi?ys.head.pjacou_ambi.push(e):ys.head.pjacou_ambi=[e]}))}("pjacou");"use strict";!function(e){ys[e]={acOptions:{algolia:{apiSearchParams:{distinct:1}},externalSearch:function(i,t,a,s){var o=this.getOptions(),r=this,l="q="+i+":";ff_m86750&&r.perfo(l+"prepare algoliaSearch");var n=null!=o.etab&&o.etab?r.getAlgoliaIndex("PROD_QuiQuoiEtabPub","quiQuoiEtab"):r.getAlgoliaIndex("PROD_QuiQuoiPub","quiQuoi"),u=o.algolia.apiSearchParams;if(u.hitsPerPage=o.max_tot+5,this.isPreLoadCall&&(u.hitsPerPage=0,this.isPreLoadCall=!1),ff_m86750&&r.perfo(l+"isQueryToSend"),!this.isQueryToSend(i))return ff_m86750&&r.perfo(l+"No ! NO algolia.search"),void t(a);null!=o.etab&&o.etab&&(u.getRankingInfo=1,u.hitsPerPage=10,u.allowTyposOnNumericTokens=0,u.useQueryEqualsOneAttributeInRanking=0,u.ruleContexts||(u.filters="is_multi_etabs:false OR not_mono_etab:true OR _type:1 OR _type:2"),u.typoTolerance="min",u.restrictSearchableAttributes=["search01","search03","search04"]),ff_m86750&&r.perfo(l+"Yes ! GO algolia.search"),n.search(i,u,(function(i,s){ff_m86750&&r.perfo(l+"Response algolia.search, err="+i),null===i&&(ys[e].hitsLoop(s,a,o),ff_m86750&&r.perfo(l+"Fin post traitement response algolia.search")),t(a)}))},histo:{shortKeys:{codeEtab:"c",adresse:"a",rubrique:"r",visuel_url:"v",geoDistance:"g"},user16i:function(e){var i=e.val().trim();if(i){var t=e.data("autocomplete").suggestions;i=i.desaccentuer().toLowerCase();for(var a=0,s=t.length;a<s;a++){var o=t[a];if(this.getOptions().algolia.tmplSourceName==o.data.tmplSource&&i==o.value.trim().desaccentuer().toLowerCase()){!o.data.notHistorisable&&this.userHisto.add(o.data);break}}}}},statsKeys:{acSollicitee:"acQuiQuoiSollicitee",rang:"rangQuiQuoi",source:"sourceQuiQuoi",type:"typeQuiQuoi",id:"idQuiQuoi",nbTop:"nbPropositionQuiQuoiTop",nbHisto:"nbPropositionQuiQuoiHisto",saisi:"quiQuoiSaisi",nbCar:"quiQuoiNbCar"},beforeInsightClickEvent:function(e,i,t,a){return{index:e.data.indexName,eventName:a.clickEventName,queryID:e.data.queryID,objectIDs:[e.data.id],positions:[e.data.indexPos+1]}}},hitsLoop:function(e,i,t,a){var s=e.hits;if(i.suggestions.length<t.max_tot)for(var o=-1,r=JSON.parse(JSON.stringify(s)),l=0;l<r.length;l++){var n,u=r[l],c=0;if((n=u._rankingInfo.nbTypos||0)>1+(-1==o?o=n:o))break;for(var g in 1==(u={index:i.suggestions.length,type_index:a||"quiquoi",tmplSource:t.algolia.tmplSourceName,statSource:t.algolia.statSourceName,type:null==u._type?"":u._type,libelle:(3==u._type?u.libelle||"":(u.search02||"")+" "+(u.libelle||"")).trim(),highlightLibelle:((u._highlightResult.search02&&u._highlightResult.search02.value?u._highlightResult.search02.value:"")+" "+(u._highlightResult.libelle.value||"")).trim(),id:u.dedupKey||"",notHistorisable:!!u.not_historisable,correctionOrtho:n>0,indexPos:l,queryID:e.queryID,indexName:e.indexUsed}).type?u.type=1:3!=u.type&&4!=u.type||(u.codeEtab=r[l].codeEtab,u.adresse=r[l].adresse,u.visuel_url=r[l].visuel_url),i.suggestions)if(i.suggestions.hasOwnProperty(g)){var h=i.suggestions[g].data;if(h.id===u.id||3!=u.type&&h.libelle===u.libelle){c=1;break}}if(!c&&(i.suggestions.push({value:u.libelle,data:u}),s.splice(l-0,1),i.suggestions.length>=t.max_tot))break}}},ys.head.onScan("input[data-pjacqq]",(function(i){$(this).data("pjalgolia",new ys.pjalgolia($(this),e,ys[e].acOptions))}))}("pjacqq");"use strict";!function(e){function t(e){var t=!1;return e&&$.each(e,(function(e,i){"full"===i.matchLevel&&(t=t||e),"partial"===i.matchLevel&&(t=(i.fullyHighlighted,t||e))})),t}function i(e){var t=!1,i=!1,a=!1;return e&&$.each(e,(function(e,s){"full"===s.matchLevel&&(t=t||s.value),"partial"===s.matchLevel&&(s.fullyHighlighted?i=i||s.value:a=a||s.value)})),t||i||a}function a(e){var t=!1;return e&&$.each(e,(function(e,i){if("full"===i.matchLevel)return t=i.value,!1})),t}ys[e]={acOptions:$.extend(!0,{},ys.pjacqq.acOptions,{autoRequestGeoloc:!0,max_geo:5,max_geo2:5,i_quiquoi:0,i_epjgeo:1,i_epjfe:2,histo:{shortKeys:{codeEtab:"c",adresse:"a",rubrique:"r",visuel_url:"v",geoDistance:"g"}},algolia:{apiSearchGeoParams:{getRankingInfo:1,facets:"",facetFilters:[],distinct:1,minimumAroundRadius:2e3,processingTimeoutMS:100,aroundPrecision:200,typoTolerance:"min",allowTyposOnNumericTokens:!1,restrictSearchableAttributes:["search01","search02","search03"]},apiSearchGeoParams2:{getRankingInfo:1,aroundRadius:"all",aroundPrecision:1e4,allowTyposOnNumericTokens:!1,distinct:1,typoTolerance:!0,restrictSearchableAttributes:["search01","search02","search03","search04"]}},beforeInsightClickEvent:function(e,t,i,a){return{index:e.data.indexName,eventName:a.clickEventName,queryID:e.data.queryID,objectIDs:[e.data.id],positions:[e.data.indexPos+1]}},externalSearch:function(t,i,a,s){var o=this.getOptions(),l=this,r="q="+t+":",u=o.algolia.apiSearchParams,n=o.algolia.apiSearchGeoParams,h=o.algolia.apiSearchGeoParams2,g=ys.head.pjGetCurrentPositionSession(),c=$("[data-pjacou]"),p=g&&c.length&&(c.val()==c.data("pjacou").autour_de_moi_libelle_init||c.val()==c.data("pjacou").autour_de_moi_libelle),d=[];if(ff_m86750&&l.perfo(r+"prepare algoliaSearch"),s.data("agGeo."+e,""),ff_m86750&&l.perfo(r+"isQueryToSend"),!l.isQueryToSend(t))return ff_m86750&&l.perfo(r+"No ! NO algolia.search"),void i(a);function _(e,t){if(2>=ys.pjalgolia.apiMajorVersion&&(e=!e),ff_m86750&&l.perfo(r+"Response algolia.search, error="+e),!e){var u=o.max_tot,h=a.suggestions.length;if(g&&c.length&&(c.val()==c.data("pjacou").autour_de_moi_libelle_init||c.val()==c.data("pjacou").autour_de_moi_libelle)){var d=[];$.each(t.results[o.i_epjgeo].hits,(function(e,t){d.push(t.dedupKey)})),$.each(t.results[o.i_epjfe].hits,(function(e,i){-1==d.indexOf(i.dedupKey)&&t.results[o.i_epjgeo].hits.push(i)}));var _=[],q=t.results[o.i_quiquoi].queryID,m=t.results[o.i_quiquoi].indexUsed,y=t.results[o.i_quiquoi].hits.filter((function(e,t,i){if(1!==e._type)return!1;e.indexPos=t;var a=e.libelle.toLowerCase().indexOf(s.val());return a>-1&&_.push(e.dedupKey),a>-1}));$.each(t.results[o.i_quiquoi].hits,(function(e,t){if(1==!t._type)return!1;-1==_.indexOf(t.dedupKey)&&(function(e,t){return-1!=t.search01.toLowerCase().indexOf(e.toLowerCase())}(s.val(),t)||function(e,t){if(!t.search03)return!1;var i=-1;return $.each(t.search03,(function(t,a){if(-1!=a.toLowerCase().indexOf(e.toLowerCase()))return i=1,!1})),-1!==i}(s.val(),t))&&(y.push(t),_.push(t.dedupKey))}));var v=h+1,j="",b=0;v>1&&(j="histo");for(var x=0;x<2;x++)1!==v&&2!==v||(2===v&&"matching"==j?((t.results[o.i_quiquoi].hits.length||t.results[o.i_epjgeo].hits.length)&&(o.max_tot=v,v++),t.results[o.i_quiquoi].hits.length?ys.pjacqq.hitsLoop(t.results[o.i_quiquoi],a,o):t.results[o.i_epjgeo].hits.length&&(ys.pjacqqgeo.geoHitsLoop(t.results[o.i_epjgeo],a,o,n,h),b++)):((y.length||t.results[o.i_epjgeo].hits.length||t.results[o.i_quiquoi].hits.length)&&(o.max_tot=v,v++),y.length?(j="matching",ys.pjacqq.hitsLoop({hits:y,indexUsed:m,queryID:q},a,o,"quoiexact")):t.results[o.i_epjgeo].hits.length?(b++,ys.pjacqqgeo.geoHitsLoop(t.results[o.i_epjgeo],a,o,n,h)):t.results[o.i_quiquoi].hits.length&&ys.pjacqq.hitsLoop(t.results[o.i_quiquoi],t.results[o.i_quiquoi].queryID,a,o)));for(x=0;x<3;x++)3!==v&&4!==v&&5!==v||((4===v||5===v)&&b>2?((t.results[o.i_epjgeo].hits.length||t.results[o.i_quiquoi].hits.length)&&(o.max_tot=v,v++),t.results[o.i_quiquoi].hits.length?ys.pjacqq.hitsLoop(t.results[o.i_quiquoi],a,o):t.results[o.i_epjgeo].hits.length&&(b++,ys.pjacqqgeo.geoHitsLoop(t.results[o.i_epjgeo],a,o,n,h))):((t.results[o.i_epjgeo].hits.length||t.results[o.i_quiquoi].hits.length)&&(o.max_tot=v,v++),t.results[o.i_epjgeo].hits.length?(b++,ys.pjacqqgeo.geoHitsLoop(t.results[o.i_epjgeo],a,o,n,h)):t.results[o.i_quiquoi].hits.length&&ys.pjacqq.hitsLoop(t.results[o.i_quiquoi],a,o)))}else o.max_tot=o.max_nongeo+h,ys.pjacqq.hitsLoop(t.results[o.i_quiquoi],a,o),p&&(o.max_tot=u,ys.pjacqqgeo.geoHitsLoop(t.results[o.i_epjgeo],a,o,n,h)),o.max_tot=u,a.suggestions.length<o.max_tot&&(f=0,ys.pjacqq.hitsLoop(t.results[f],a,o));ff_m86750&&l.perfo(r+"Fin post traitement response algolia.search")}i(a)}if(l.isPreLoadCall?(h.hitsPerPage=n.hitsPerPage=u.hitsPerPage=0,l.isPreLoadCall=!1):(u.hitsPerPage=o.max_nongeo+o.max_geo+5,n.hitsPerPage=o.max_geo+2,h.hitsPerPage=o.max_geo2),u.ruleContexts||(u.filters="not_mono_etab:true OR _type:1"),d.push({indexName:this.getAlgoliaIndexName("quiQuoi","PROD_QuiQuoiPub"),query:t,params:u}),p&&(n.aroundLatLng=g.coords.latitude+","+g.coords.longitude,s.data("agGeo."+e,n.aroundLatLng),d.push({indexName:this.getAlgoliaIndexName("etab","PROD_EtabPub_v2"),query:t,params:n}),h.aroundLatLng=g.coords.latitude+","+g.coords.longitude,s.data("agGeo2."+e,n.aroundLatLng),d.push({indexName:this.getAlgoliaIndexName("etab","PROD_EtabPub_v2"),query:t,params:h})),ff_m86750&&l.perfo(r+"Yes ! GO algolia.search"),3<=ys.pjalgolia.apiMajorVersion)l.getAlgoliaSearch().search(d,_);else{var q=l.getAlgoliaSearch();q.startQueriesBatch();var f=0;2==d.length&&(q.addQueryInBatch(d[f].indexName,d[f].query,d[f].params),f++),q.addQueryInBatch(d[f].indexName,d[f].query,d[f].params),q.sendQueriesBatch(_)}},beforeSubmit:function(e,t,i,a){var s=e?e.data:{};return s.codeEtab&&t.pjSetHiddenValue("idQuiQuoi",s.codeEtab),s.rubrique&&s.rubrique.an9&&t.pjSetHiddenValue("code_rubrique",s.rubrique.an9),!0}}),geoHitsLoop:function(e,s,o,l,r){for(var u=-1,n=e.hits,h=n,g=0,c=0;c<h.length;c++){var p,d,_=h[c],q=0;if("none"!==_._highlightResult.search01.matchLevel||!1!==i(_._highlightResult.search03)||!1!==i(_._highlightResult.search02)){if((d=_._rankingInfo.nbTypos||0)>1+(-1==u?u=d:u))break;var f=_._rankingInfo.matchedGeoLocation.distance;f=(f=f>=1e3?Number(f/1e3).toFixed(1)+" km":f+" m").replace(".",","),p={index:s.suggestions.length,type_index:"epj",tmplSource:o.algolia.tmplSourceName,statSource:o.algolia.statSourceName,type:null==_._type?"":_._type,libelle:(("full"===_._highlightResult.libelle.matchLevel||a(_._highlightResult.search03)||!1===i(_._highlightResult.search02)?"":_.search02[t(_._highlightResult.search02)])+" "+(_.libelle||"")).trim(),activite:"full"===_._highlightResult.libelle.matchLevel||a(_._highlightResult.search03)||!1===i(_._highlightResult.search02)?"":i(_._highlightResult.search02),highlightLibelle:("full"===_._highlightResult.libelle.matchLevel||"partial"===_._highlightResult.libelle.matchLevel&&_._highlightResult.libelle.fullyHighlighted||!1===i(_._highlightResult.search03)?_._highlightResult.libelle.value||"":i(_._highlightResult.search03)).trim(),id:_.dedupKey||"",correctionOrtho:d>0,geo:l.aroundLatLng,geoDistance:f,rubrique:_.rubrique||"",visuel_url:_.visuel_url||""},void 0!==_.indexPos?p.indexPos=_.indexPos:p.indexPos=c,p.queryID=e.queryID,p.indexName=e.indexUsed,1==p.type?p.type=1:3!=p.type&&4!=p.type||(p.codeEtab=_.codeEtab,p.adresse=_.adresse);var m=0;for(var y in s.suggestions)if(s.suggestions.hasOwnProperty(y)){if(m==r)break;if(s.suggestions[y].data.id===p.id){q=1;break}m++}if(!q&&(s.suggestions.push({value:p.libelle,data:p}),n.splice(c-g,1),g++,s.suggestions.length>=o.max_tot))break}}}},ys.head.onScan("input[data-"+e+"]",(function(t){var i,a;$(this).data("pjalgolia",i=new ys.pjalgolia($(this),e,ys[e].acOptions)),i.resetStatsValues=(a=i.resetStatsValues,function(t){a.call(this,t);var i=this._.$input.pjForm();this.statValue("geo",this._.$input.data("agGeo."+e),"",i),this.statValue("nbPropositionQuiQuoiGeo",this._.$input.data("nbGeo."+e),0,i)}),i.getOptions().autoRequestGeoloc&&$(this).pjGetCurrentPosition((function(){}));var s=$(this).data("pjalgolia")._.options;ys.head.$doc.on("click",s.appendTo+" ."+s.containerClass.split(" ").join(".")+" :submit",(function(){ys.head.pjformxvalid_prevent=!0}))}))}("pjacqqgeo");"use strict";!function(e){ys.head.onScan("input[data-"+e+"]",(function(){$(this).data("pjalgolia",new ys.pjalgolia($(this),e,{autoSelectFirst:!0,algolia:{apiSearchParams:{facets:"_geoType",facetFilters:["_geoType:Localite"]}},externalSearch:function(e,a,t,i){var s=this.getOptions(),o=this.getAlgoliaIndex("PROD_OuPub","ou");this.isQueryToSend(e)?o.search(e,s.algolia.apiSearchParams,(function(e,i){if(null===e){var o=-1;for(var l in i.hits){var r=i.hits[l],n=0;for(var g in t.suggestions){if(t.suggestions.hasOwnProperty(g))if(t.suggestions[g].data.id===r.objectID){n=1;break}}if(!n){var c=r._highlightResult.libelle.value.replace("<NUMVOIE>","").trim(),u=r._rankingInfo.nbTypos||0;if(u>1+(-1==o?o=u:o))break;if(r={index:t.suggestions.length,tmplSource:s.algolia.tmplSourceName,statSource:s.algolia.statSourceName,type:r._geoType,libelle:"VOIE"===r._geoType.toUpperCase()?ys.head.strip_tags(c):r.libelle.replace("<NUMVOIE>","").trim(),highlightLibelle:c,id:r.objectID,notHistorisable:!!r.not_historisable,correctionOrtho:u>0},t.suggestions.push({value:r.libelle,data:r}),t.suggestions.length>=s.max_tot)break}}}a(t)})):a(t)},statsKeys:{id:"geoloc[idOu]"}}))}))}("pjacloc");